<div class="min-h-screen bg-gray-50 py-8">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Mis Órdenes</h1>
      <p class="text-gray-600">Historial de tus exámenes de laboratorio</p>
    </div>

    <!-- Loading -->
    @if (loading()) {
      <div class="text-center py-12">
        <div class="inline-block w-8 h-8 border-4 border-sky-200 border-t-sky-500 rounded-full animate-spin"></div>
        <p class="mt-4 text-gray-600">Cargando órdenes...</p>
      </div>
    }

    <!-- Error -->
    @if (error()) {
      <div class="p-4 bg-red-50 border border-red-200 rounded-xl text-red-800">
        {{ error() }}
      </div>
    }

    <!-- Orders List -->
    @if (!loading() && !error()) {
      @if (orders().length === 0) {
        <div class="text-center py-16 bg-white rounded-2xl shadow-sm">
          <div class="w-20 h-20 mx-auto mb-6 bg-gray-100 rounded-full flex items-center justify-center">
            <svg class="w-10 h-10 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
            </svg>
          </div>
          <h2 class="text-2xl font-bold text-gray-900 mb-2">No tienes órdenes</h2>
          <p class="text-gray-600 mb-6">Aún no has realizado ninguna orden</p>
          <a
            routerLink="/search"
            class="inline-flex items-center gap-2 px-6 py-3 bg-sky-500 text-white rounded-xl font-bold hover:bg-sky-600 transition"
          >
            Buscar exámenes
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
            </svg>
          </a>
        </div>
      } @else {
        <div class="space-y-4">
          @for (order of orders(); track order.orderNumber) {
            <div class="bg-white rounded-2xl shadow-sm overflow-hidden">
              <!-- Order Header -->
              <div
                class="p-6 cursor-pointer hover:bg-gray-50 transition"
                (click)="toggleExpand(order.orderNumber)"
              >
                <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                  <div>
                    <div class="flex items-center gap-3 mb-1">
                      <span class="font-bold text-gray-900">{{ order.orderNumber }}</span>
                      <span
                        [class]="'px-3 py-1 rounded-full text-xs font-semibold ' + getStatusBadgeClass(order.status)"
                      >
                        {{ getStatusLabel(order.status) }}
                      </span>
                    </div>
                    <p class="text-sm text-gray-500">{{ formatDate(order.createdAt) }}</p>
                  </div>

                  <div class="flex items-center gap-6">
                    <div class="text-right">
                      <p class="text-2xl font-bold text-sky-500">${{ order.totalAmount | number }}</p>
                      <p class="text-sm text-gray-500">{{ order.items.length }} item(s)</p>
                    </div>
                    <svg
                      class="w-5 h-5 text-gray-400 transition-transform"
                      [class.rotate-180]="expandedOrder() === order.orderNumber"
                      fill="none"
                      stroke="currentColor"
                      viewBox="0 0 24 24"
                    >
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                  </div>
                </div>

                <!-- Items Summary -->
                <div class="mt-4 flex flex-wrap gap-2">
                  @for (item of order.items; track item.serviceCode) {
                    <span class="px-3 py-1 bg-gray-100 text-gray-700 rounded-lg text-sm">
                      {{ item.serviceName }}
                      @if (item.quantity > 1) {
                        <span class="text-gray-500">(x{{ item.quantity }})</span>
                      }
                    </span>
                  }
                </div>
              </div>

              <!-- Expanded Details -->
              @if (expandedOrder() === order.orderNumber) {
                <div class="px-6 pb-6 border-t border-gray-100 pt-4">
                  <!-- Laboratory Info -->
                  <div class="mb-6">
                    <h3 class="font-semibold text-gray-900 mb-2">Laboratorio</h3>
                    <div class="p-4 bg-gray-50 rounded-xl">
                      <p class="font-medium text-gray-900">{{ order.pos.name }}</p>
                      <p class="text-gray-600">{{ order.pos.address }}</p>
                      @if (order.pos.phone) {
                        <p class="text-gray-500 text-sm mt-1">Tel: {{ order.pos.phone }}</p>
                      }
                    </div>
                  </div>

                  <!-- Walk-in Ticket -->
                  @if (order.walkInTicket) {
                    <div class="mb-6">
                      <h3 class="font-semibold text-gray-900 mb-2">Código para el laboratorio</h3>
                      <div class="p-6 bg-sky-50 border-2 border-sky-200 border-dashed rounded-xl text-center">
                        <p class="text-4xl font-bold text-sky-500 tracking-widest">{{ order.walkInTicket.ticketCode }}</p>
                        <p class="text-sm text-sky-600 mt-2">
                          Válido hasta: {{ formatDate(order.walkInTicket.expiresAt) }}
                        </p>
                      </div>
                    </div>
                  }

                  <!-- Items Detail -->
                  <div>
                    <h3 class="font-semibold text-gray-900 mb-2">Detalle</h3>
                    <div class="space-y-2">
                      @for (item of order.items; track item.serviceCode) {
                        <div class="flex justify-between py-2 border-b border-gray-100 last:border-0">
                          <div>
                            <p class="font-medium text-gray-900">{{ item.serviceName }}</p>
                            <p class="text-sm text-gray-500">${{ item.unitPrice | number }} x {{ item.quantity }}</p>
                          </div>
                          <p class="font-medium text-gray-900">${{ item.totalPrice | number }}</p>
                        </div>
                      }
                    </div>
                    <div class="flex justify-between mt-4 pt-4 border-t-2 border-gray-200">
                      <span class="text-lg font-bold text-gray-900">Total</span>
                      <span class="text-lg font-bold text-sky-500">${{ order.totalAmount | number }}</span>
                    </div>
                  </div>
                </div>
              }
            </div>
          }
        </div>
      }
    }
  </div>
</div>
